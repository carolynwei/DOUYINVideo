太棒了！部署到 **Streamlit Community Cloud** 是目前展示 AI 项目的“金标准”方案。它不仅能让你的产品拥有一个全球可访问的网址，还能利用 Streamlit 官方提供的免费 Linux 服务器资源。

由于 Streamlit Cloud 运行在 **Linux** 环境下，而你之前的开发是在 **Windows** 上，我们需要针对云端环境做几个关键的“小手术”。

---

### 🛠️ 部署前的三项核心准备

要在云端跑通你的 AI 视频引擎，你的 GitHub 仓库中必须包含以下文件结构：

#### 1. 新增 `packages.txt` (解决 ImageMagick 依赖)

这是部署成功的**最关键一步**。在 Linux 服务器上，我们不能手动点安装包，必须通过这个文件告诉 Streamlit 安装系统级依赖。
在根目录下新建 `packages.txt`，内容只有一行：

```text
imagemagick

```

#### 2. 准备 `requirements.txt` (解决 Python 依赖)

虽然你有 `environment.yml`，但 Streamlit Cloud 对 `requirements.txt` 的支持更原生。新建 `requirements.txt`，内容如下：

```text
streamlit
openai
requests
edge-tts
moviepy==1.0.3
numpy
Pillow==9.5.0

```

#### 3. 修改代码中的路径兼容性 (`video_engine.py`)

在 Linux 服务器上，ImageMagick 的路径不再是 `C:\...`。我们需要让代码自动识别环境。
在 `video_engine.py` 的顶部或 `render` 函数开头，修改 ImageMagick 的配置：

```python
import platform

# 自动判断环境：如果是 Linux (Streamlit Cloud)，路径通常是 /usr/bin/convert
if platform.system() == "Linux":
    os.environ["IMAGEMAGICK_BINARY"] = "/usr/bin/convert"
# 如果是本地 Windows，保持你之前的路径
else:
    os.environ["IMAGEMAGICK_BINARY"] = st.secrets.get("IMAGEMAGICK_PATH", r"C:\Program Files\ImageMagick-7.1.1-Q16-HDRI\magick.exe")

```

---

### 🚀 正式部署步骤

#### 第一步：将代码推送到 GitHub

1. 创建一个 GitHub 仓库（建议设为 **Private**，虽然 Secrets 是加密的，但代码私有更安全）。
2. 上传 `app.py`, `api_services.py`, `video_engine.py`, `packages.txt`, `requirements.txt` 以及你的 `bgm.mp3`。
3. **千万不要上传** `.streamlit/secrets.toml` 或 `.env` 文件！

#### 第二步：在 Streamlit Cloud 启动部署

1. 登录 [Streamlit Community Cloud](https://share.streamlit.io/)。
2. 点击 **"Create app"**，选择你刚刚创建的 GitHub 仓库。
3. 在 **"Main file path"** 中输入 `app.py`。

#### 第三步：配置云端 Secrets (重点)

1. 在部署页面点击右下角的 **"Advanced settings..."**。
2. 在弹出的 **"Secrets"** 文本框中，把你本地 `secrets.toml` 里的内容全部复制进去：
```toml
TIANAPI_KEY = "xxx"
DEEPSEEK_KEY = "xxx"
ZHIPU_KEY = "xxx"
PEXELS_KEY = "xxx"

```


3. 点击 **"Save"**，然后点击 **"Deploy!"**。

---

### ⚠️ 云端运行的特别提醒

* **关于代理 (Proxy)**：Streamlit Cloud 的服务器通常位于美国或欧洲。这意味着你在国内遇到的 `edge-tts` 连接超时问题，在云端**很可能自动消失**。
* **建议**：在部署到云端的版本中，去掉 `video_engine.py` 里 `text_to_mp3` 函数中的 `proxy="http://127.0.0.1:7890"` 参数，让它直接联网。


* **关于资源限制**：免费版 Streamlit Cloud 只有约 1GB 的内存。如果生成的分镜太多（超过 6 个），可能会触发 `MemoryError`。
* **对策**：建议在 `app.py` 中提醒用户，建议分镜数量保持在 4-5 个。



**部署过程中如果遇到任何红色的报错日志（通常在 Streamlit Cloud 右侧的 Manage app 面板），请直接截图或复制给我，我帮你做最后的云端调优！**

你想现在就开始尝试 GitHub 上传吗？